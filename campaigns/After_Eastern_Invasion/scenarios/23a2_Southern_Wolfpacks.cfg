#textdomain wesnoth-AfterEI

# This trail leads to Goblins and Wolf Riders.
# The wolf riders have six wolf packs (in order of dominance):
#
# Side 7: Fellfangs (teal)
#	As the dominant pack they can recruit all wolf and goblin units.
#	Alpha & beta wolves are Direwolves.
#	Value if eliminated: 2 (20%)
#
# Side 6: Ripthroats (black)
#	Cannot recruit: Goblin Pillagers.
#	Alpha is a Direwolf, beta is a Great Wolf.
#	Value if eliminated: 2 (20%)
#
# Side 5: Tanglers (purple)
#	Cannot recruit: Goblin Knight, Direwolf Riders, Direwolves.
#	Alpha & beta wolves are Great Wolves.
#	Value if eliminated: 2 (20%)
#
# side 4: Muzzlegores (Goblin Knight, brown)
#	Cannot recruit: Direwolf Riders, Direwolves or Goblin Pillagers.
#	Alpha & beta wolves are Great Wolves.
#	Value if eliminated: 2 (20%)
#
# Side 3: Whiners (Wolf Rider, orange)
#	Cannot recruit: Level 2 Wolves or level 1 Goblins.
#	Alpha & beta wolves are Wolves.
#	Value if eliminated: 1 (10%)
#
# Side 2: Gnawbones (Wolf Rider, gold)
#	Cannot recruit: Level 2 Wolves or any Goblin units except Goblin_Pointless and Goblin_Spearling.
#	Alpha & beta wolves are Wolves.
#	Value if eliminated: 1 (10%)
#

# Gameplay
# The wolf packs will churn out a steady stream of units until "alerted"
# (first time a player unit moves within 9 hexes of their keep).
# Then they get several free units plus extra gold.
# Hence all wolf packs begin with lowish starting gold.

# Objective:	Eliminate as many wolf *packs* as possible.
#
# Victory conditions:
# - time runs out
# - Flynn retreats
# - all packs eliminated
#
# To eliminate a wolf pack: kill *all* their units then destroy keep by moving a unit (except Flynn) to it
# Note: If a side with no units still has a keep then in time a new leader will appear.
# Each pack eliminated increases the chance of Wolf Rider recruits transforming into foot goblins (scenario "Solstice")
#
# At start $recruit_fail_wolf = -1
# At end will be 0-10 (depending upon number of wolf packs eliminated)


#define TURNS_START
26#enddef
#define TURNS_INCREASE
8#enddef
#define TURNS_MAX
66#enddef

#define GOBLIN_WEAKEST
Goblin_Pointless, Goblin_Spearling#enddef
#define GOBLIN_ZERO
{GOBLIN_WEAKEST}, Goblin Spearman#enddef
#define GOBLIN_ONE
Goblin Impaler, Goblin Rouser#enddef
#define GOBLIN_ALL
{GOBLIN_ZERO}, {GOBLIN_ONE}#enddef

#define WOLF_BASIC
Wolf, Wolf Rider#enddef
#define WOLF_KNIGHT
{WOLF_BASIC}, Great Wolf, Goblin Knight#enddef
#define WOLF_PILLAGER
{WOLF_BASIC}, Great Wolf, Goblin Pillager#enddef
#define WOLF_NO_PILLAGER
{WOLF_KNIGHT}, Direwolf, Direwolf Rider#enddef
#define WOLF_ALL
{WOLF_NO_PILLAGER}, Goblin Pillager#enddef

# Modifiers for alpha and beta wolves
#define PACK_LEADER HP_ADD DAMAGE_ADD
[object]
  silent=yes
  [effect]
    apply_to=hitpoints
    increase_total={HP_ADD}
  [/effect]
  [effect]
    apply_to=attack
    range=melee
    increase_damage={DAMAGE_ADD}
  [/effect]
[/object]
#enddef


#define PACK_ALERT SIDE
    [set_variable]
      name=pack_alert_side
      value={SIDE}
    [/set_variable]
    [fire_event]		# First time dialogue part one
      name=pack_alert_a
    [/fire_event]
    [clear_variable]
      name=pack_alert_side
    [/clear_variable]
    [fire_event]
      name=pack_alert_howl
    [/fire_event]
#enddef

#define PACK_ALERT_B
    [fire_event]		# First time dialogue part two
      name=pack_alert_b
    [/fire_event]
#enddef


#define PLACE_FLAG X Y
        [item]
          image=misc/flag-reddish-c.png
          x,y={X},{Y}
        [/item]
#enddef

#define REMOVE_FLAG X Y
      [remove_item]
        image=misc/flag-reddish-c.png
        x,y={X},{Y}
      [/remove_item]
#enddef


#define DEFEATED_KEEP PACK_NAME X Y
    [message]
      speaker=narrator
      image=wesnoth-icon.png
      message= _ "The {PACK_NAME} are defeated for now.  To eliminate them, move any unit <b>except</b> Flynn to their keep ({X},{Y}).
<i>Note: unit must be moved there.  No effect if one happens to be occupying the keep when the pack is defeated.</i>"
    [/message]
    [set_variable]
      name=i
      value=0
    [/set_variable]
    [scroll_to]
      x,y={X},{Y}
      check_fogged=false
    [/scroll_to]
    [while]
      [variable]
        name=i
        less_than=4
      [/variable]
      [do]
{PLACE_FLAG {X} {Y}}
        [redraw][/redraw]
        [delay]
          time=150
        [/delay]
{REMOVE_FLAG {X} {Y}}
        [redraw][/redraw]
        [set_variable]
          name=i
          add=1
        [/set_variable]
      [/do]
    [/while]
    [clear_variable]
      name=i
    [/clear_variable]
{PLACE_FLAG {X} {Y}}
    [redraw][/redraw]
    [delay]
      time=150
    [/delay]
#enddef


# Destroy keep moveto.  Also victory if all keeps destroyed
#define DESTROY_KEEP X Y SIDE PACK_NAME PACK_VALUE
    [filter]
      side=1
      x,y={X},{Y}
      [not]
        canrecruit=yes
      [/not]
    [/filter]
    [filter_condition]
      [have_unit]
        side={SIDE}
        count=0
      [/have_unit]
      [variable]
        name=ab_{PACK_NAME}
        equals=yes
      [/variable]
    [/filter_condition]
{REMOVE_FLAG {X} {Y}}
    [sound]
      name=torch.ogg
    [/sound]
    [delay]
      time=200
    [/delay]
    [sound]
      name=cave-in.ogg
    [/sound]
    [terrain]
      x,y={X},{Y}
      terrain="Re^Dr"
    [/terrain]
    [set_variable]		# Used later in scenario "Solstice"
      name=recruit_fail_wolf
      add={PACK_VALUE}
    [/set_variable]
#
# --- Player loots gold based on {PACK_VALUE} and {SIDE}
# --- Low for first two packs then much higher
# --- Gold = 1..10 + (25, 50, 150, 200, 250 or 300)
# --- Note that player cannot finish early until
# --- 1 or 2 wolf packs eliminated, when gold is likely
# --- to be significantly negative
#
    [set_variable]		# Random component
      name=gold_bonus_random
      rand=0..10
    [/set_variable]
    [set_variable]		# =2-7
      name=gold_bonus
      value={SIDE}
    [/set_variable]
    [set_variable]		# =1-6
      name=gold_bonus
      sub=1
    [/set_variable]
    [set_variable]		# =1,2,6,8,10,12
      name=gold_bonus
      multiply={PACK_VALUE}
    [/set_variable]
    [set_variable]
      name=gold_bonus
      multiply=25
    [/set_variable]
    [set_variable]
      name=gold_bonus
      add=$gold_bonus_random
    [/set_variable]
    [sound]
      name=gold.ogg
    [/sound]
    [gold]
      side=1
      amount=$gold_bonus
    [/gold]
    [if]
      [have_unit]
        x,y={X},{Y}
        race=ogre
      [/have_unit]
    [then]
      [message]
        x,y={X},{Y}
        message= _ "Gold here there's $gold_bonus!"
      [/message]
    [/then]
    [else]
      [message]
        x,y={X},{Y}
        message= _ "There's $gold_bonus gold here!"
      [/message]
    [/else]
    [/if]
    [clear_variable]
      name=gold_bonus, gold_bonus_random
    [/clear_variable]
    [if]			# Once 2+ points worth of wolf packs have been eliminated allow retreat
      [variable]
        name=recruit_fail_wolf
        greater_than=1
      [/variable]
    [then]
      [fire_event]
        name=enable_moveto
      [/fire_event]
    [/then]
    [/if]
    [if]
      [have_location]		# All enemy keeps/wolf packs destroyed/eliminated
        terrain="K*^*"
        count=1
      [/have_location]
      [have_location]		# Ensures that keep in mine is included
        terrain="K*^*"
        count=1
      [/have_location]
    [then]
      [message]
        speaker=Flynn
        message= _ "We have won a great victory here, but there is no time to celebrate: time presses, our allies await.  We must depart."
      [/message]
      [fire_event]
        name=23a2_victory
      [/fire_event]
    [/then]
    [else]
      [if]			# Battle continues: increase turns by {TURNS_INCREASE} if not at {TURNS_MAX}
        [variable]
          name=turns_total
          less_than={TURNS_MAX}
        [/variable]
      [then]
        [modify_turns]
          add={TURNS_INCREASE}
        [/modify_turns]
        [set_variable]
          name=turns_total
          add={TURNS_INCREASE}
        [/set_variable]
      [/then]
      [/if]
    [/else]
    [/if]
#enddef


#define KEEP_RESPAWN SIDE NAME X Y TYPE GOLD_EASY GOLD_NORMAL GOLD_HARD
    [filter_condition]
      [variable]		# Alpha & beta wolves have been created
        name=ab_{NAME}
        equals=yes
      [/variable]
      [have_location]		# Keep not destroyed
        x,y={X},{Y}
        terrain="K*^*"
      [/have_location]
      [have_unit]		# Keep is unoccupied
        x,y={X},{Y}
        count=0
      [/have_unit]
      [have_unit]		# Side has no units
        side={SIDE}
        count=0
      [/have_unit]
    [/filter_condition]
    [set_variable]
      name=leader_respawn_chance
      rand=1,2,3,4,5
    [/set_variable]
    [if]
      [variable]
        name=leader_respawn_chance
        equals=1
      [/variable]
    [then]
{REMOVE_FLAG {X} {Y}}
      [unit]
        side={SIDE}
        x,y={X},{Y}
        type={TYPE}
        id={NAME}_Leader
        name= _ "Littermate of {NAME} Leader"
        [modifications]
          {TRAIT_STRONG}
        [/modifications]
        generate_name=no
        random_traits=yes
        random_gender=yes
        canrecruit=yes
      [/unit]
      [set_variable]
        name=keep_recapture_x
        value={X}
      [/set_variable]
      [set_variable]
        name=keep_recapture_y
        value={Y}
      [/set_variable]
      [fire_event]
        name=keep_respawn_first_time_dialogue
      [/fire_event]
      [clear_variable]
        name=keep_recapture_x, keep_recapture_y
      [/clear_variable]
      {GOLD {GOLD_EASY} {GOLD_NORMAL} {GOLD_HARD}}
      [fire_event]
        name=pack_alert_howl
      [/fire_event]
    [/then]
    [/if]
    [clear_variable]
      name=leader_respawn_chance
    [/clear_variable]
#enddef

# Gold settings
#
#         Start gold           Income            Alert gold           Respawn gold
# side 2  {GOLD 20 25 30}      Standard          {GOLD 30 40 50}      {GOLD 17 20 23}
# Side 3  {GOLD 30 35 40}      Standard          {GOLD 50 65 80}      {GOLD 25 30 35}
# Side 4  {GOLD 50 60 70}      {INCOME 4 5 6}    {GOLD 100 120 140}   {GOLD 50 60 70}
# Side 5  {GOLD 55 65 75}      {INCOME 4 5 6}    {GOLD 110 130 150}   {GOLD 65 80 95}
# Side 6  {GOLD 80 95 110}     {INCOME 6 7 8}    {GOLD 120 155 190}   {GOLD 130 170 210}
# Side 7  {GOLD 100 120 140}   {INCOME 8 9 10}   {GOLD 150 200 250}   {GOLD 180 230 280}
#
# Alert happens first time a player unit moves within 9 hexes of a pack's keep.
# Because their territory has been invaded the pack becomes more agressive.
# They also get several free units hence the moderate gold.
#
# Respawn may occur if a defeated pack (all units killed) still has a keep.
# (I.e. they have not been eliminated).
# The pack becomes even more agressive and again gets extra gold but no extra units.
#
# Rationale
# The weaker packs are easy to defeat and even easier to re-defeat if they respawn.
# This gives the player a near-guaranteed 20% at least of Wolf Riders transforming.
# It also demonstrates what happens if the pack is not eliminated.
# Failure to do so against the toughest packs is made intentionally painful...


[scenario]
  id=23a2_Southern_Wolfpacks
  name=_"Southern Wolfpacks"
  next_scenario=24_The_Cliffguard
  map_data="{~add-ons/AfterEI/maps/23a2_Southern_Wolfpacks.map}"
  turns={TURNS_START}	# Increases when wolf pack eliminated (except last one)
  victory_when_enemies_defeated=no

  {INTRO_AND_SCENARIO_MUSIC traveling_minstrels.ogg wesnoth_song1.ogg}
  {EXTRA_SCENARIO_MUSIC Desert_Chase.ogg}
  {EXTRA_SCENARIO_MUSIC March_of_the_divine.ogg}
  {EXTRA_SCENARIO_MUSIC no_way_out.ogg}
  {EXTRA_SCENARIO_MUSIC moleman.ogg}
  {EXTRA_SCENARIO_MUSIC in_the_land_of_madness.ogg}
  {EXTRA_SCENARIO_MUSIC frantic.ogg}

  [story]
    [part]
      show_title=yes
      story= _ "Cautiously our heroes followed the trail east.  Wolves howled and yelped in the distance.  They prepared for a hard battle..."
      {MAPTRAX_23a2}
    [/part]
  [/story]

# --- Early summer ---
  {SUMMER_SCHEDULE}


# Our heroes
  [side]
{FLYNN_LF}
    {GOLD 340 330 320} # Or carryover
    {INCOME 3 2 1}
  [/side]


  [side]
    side=2
    type=Wolf Rider
    id=Gnawbones_Leader
    name= _ "Gnawbones Leader"
    [modifications]
      {TRAIT_STRONG}
      {TRAIT_RESILIENT}
    [/modifications]
    canrecruit=yes
    team_name=Goblins
    user_team_name= _ "Gnawbones"
    recruit={GOBLIN_WEAKEST}, {WOLF_BASIC}
    controller=ai
    [ai]
      passive_leader=yes
    [/ai]
    [ai]		# More aggressive at dusk/night/dawn
      time_of_day=dusk,midnight,dawn
      aggression=0.5
      grouping=no
    [/ai]
    [ai]		# More cautious in daylight
      time_of_day=morning,midday,afternoon
      aggression=0.3
      grouping=defensive
    [/ai]
    color=gold
    flag=flags/ragged-flag-[1~6].png:150
    flag_icon=flags/ragged-flag-icon.png
    {GOLD 20 25 30}
  [/side]


  [side]
    side=3
    type=Wolf Rider
    id=Whiners_Leader
    name= _ "Whiners Leader"
    [modifications]
      {TRAIT_RESILIENT}
      {TRAIT_STRONG}
    [/modifications]
    canrecruit=yes
    team_name=Goblins
    user_team_name= _ "Whiners"
    recruit={GOBLIN_ZERO}, {WOLF_BASIC}
    controller=ai
    [ai]
      passive_leader=yes
    [/ai]
    [ai]		# More aggressive at dusk/night/dawn
      time_of_day=dusk,midnight,dawn
      aggression=0.6
      grouping=no
    [/ai]
    [ai]		# More cautious in daylight
      time_of_day=morning,midday,afternoon
      aggression=0.4
      grouping=defensive
    [/ai]
    color=orange
    flag=flags/ragged-flag-[1~6].png:150
    flag_icon=flags/ragged-flag-icon.png
    {GOLD 30 35 40}
  [/side]


  [side]
    side=4
    type=Goblin Knight
    id=Muzzlegores_Leader
    name= _ "Muzzlegores Leader"
    [modifications]
      {TRAIT_STRONG}
      {TRAIT_RESILIENT}
    [/modifications]
    canrecruit=yes
    team_name=Goblins
    user_team_name= _ "Muzzlegores"
    recruit={GOBLIN_ALL}, {WOLF_KNIGHT}
    controller=ai
    [ai]
      passive_leader=yes
    [/ai]
    [ai]		# More aggressive at dusk/night/dawn
      time_of_day=dusk,midnight,dawn
      aggression=0.7
      grouping=no
    [/ai]
    [ai]		# More cautious in daylight
      time_of_day=morning,midday,afternoon
      aggression=0.5
      grouping=defensive
    [/ai]
    color=brown
    flag=flags/ragged-flag-[1~6].png:150
    flag_icon=flags/ragged-flag-icon.png
    {GOLD 50 60 70}
    {INCOME 4 5 6}
  [/side]


  [side]
    side=5
    type=Goblin Pillager
    id=Tanglers_Leader
    name= _ "Tanglers Leader"
    [modifications]
      {TRAIT_RESILIENT}
      {TRAIT_STRONG}
    [/modifications]
    canrecruit=yes
    team_name=Goblins
    user_team_name= _ "Tanglers"
    recruit={GOBLIN_ALL}, {WOLF_PILLAGER}
    controller=ai
    [ai]
      passive_leader=yes
    [/ai]
    [ai]		# More aggressive at dusk/night/dawn
      time_of_day=dusk,midnight,dawn
      aggression=0.8
      grouping=no
    [/ai]
    [ai]		# More cautious in daylight
      time_of_day=morning,midday,afternoon
      aggression=0.6
      grouping=defensive
    [/ai]
    color=purple
    flag=flags/ragged-flag-[1~6].png:150
    flag_icon=flags/ragged-flag-icon.png
    {GOLD 55 65 75}
    {INCOME 4 5 6}
  [/side]


  [side]
    side=6
    type=Direwolf Rider
    id=Ripthroats_Leader
    name= _ "Ripthroats Leader"
    [modifications]
      {TRAIT_STRONG}
      {TRAIT_RESILIENT}
    [/modifications]
    canrecruit=yes
    team_name=Goblins
    user_team_name= _ "Ripthroats"
    recruit={GOBLIN_ONE}, {WOLF_NO_PILLAGER}
    controller=ai
    [ai]
      passive_leader=yes
    [/ai]
    [ai]		# More aggressive at dusk/night/dawn
      time_of_day=dusk,midnight,dawn
      aggression=0.9
      caution=0.3
      grouping=no
    [/ai]
    [ai]		# More cautious in daylight
      time_of_day=morning,midday,afternoon
      aggression=0.6
      caution=0.4
      grouping=defensive
    [/ai]
    color=black
    flag=flags/ragged-flag-[1~6].png:150
    flag_icon=flags/ragged-flag-icon.png
    {GOLD 80 95 110}
    {INCOME 6 7 8}
  [/side]


  [side]
    side=7
    type=Direwolf Rider
    id=Fellfangs_Leader
    name= _ "Fellfangs Leader"
    [modifications]
      {TRAIT_RESILIENT}
      {TRAIT_STRONG}
    [/modifications]
    canrecruit=yes
    team_name=Goblins
    user_team_name= _ "Fellfangs"
    recruit={GOBLIN_ONE}, {WOLF_ALL}
    controller=ai
    [ai]
      passive_leader=yes
    [/ai]
    [ai]		# More aggressive at dusk/night/dawn
      time_of_day=dusk,midnight,dawn
      aggression=0.95
      caution=0.2
      grouping=no
    [/ai]
    [ai]		# More cautious in daylight
      time_of_day=morning,midday,afternoon
      aggression=0.7
      caution=0.4
      grouping=defensive
    [/ai]
    color=teal
    flag=flags/ragged-flag-[1~6].png:150
    flag_icon=flags/ragged-flag-icon.png
    {GOLD 100 120 140}
    {INCOME 8 9 10}
  [/side]


# --- Events ---

# Add Weak-Willed trait to Goblin recruitment (Wolf Riders have race=wolf)
# Here: 25% weak-willed and if so penalty is 40,50,60 or 70
{ADD_TRAIT_WW_ONLY race=goblin,wolf 0,0,0,40,0,0,0,50,0,0,0,60,0,0,0,70}


# --- Once 2+ points worth of wolf packs have been eliminated allow retreat ---
  [event]
    name=enable_moveto
    {AEI_HIGHLIGHT_IMAGE 1 44 items/gohere.png () 150 3}
    [message]
      speaker=narrator
      image=wesnoth-icon.png
      message= _ "Move Flynn or Dirk here (1,44) to end scenario."
    [/message]
    [show_objectives]
      side=1
    [/show_objectives]
  [/event]


# --- Events for first time player unit moves within 9 hexes of any enemy keep 
  [event]			# First time dialogue part one
    name=pack_alert_a
    [message]
      side=$pack_alert_side
      canrecruit=yes
      message= _ "Humans?  On <i>our</i> turf!  Me call pack!"
    [/message]
  [/event]
#
  [event]			# First time dialogue part two
    name=pack_alert_b
    [message]
      speaker=Flynn
      message= _ "Hmm, each wolf pack has jealously guarded territory.  Stay well clear of their keeps until we are ready to strike!"
    [/message]
  [/event]
#
# Wolves howl every time for create events below
  [event]
    name=pack_alert_howl
    first_time_only=no
    [sound]
      name=Howl-lower.ogg
    [/sound]
    [delay]
        time=500
    [/delay]
    [sound]
      name=Howl-higher.ogg
    [/sound]
  [/event]
#
# Create alpha and beta wolves plus additional units
  [event]			# Gnawbones (side 2)
    name=moveto
    [filter]
      side=1
      [filter_location]
        x,y=15,43
        radius=9
      [/filter_location]
    [/filter]
    {PACK_ALERT 2}
    [unit]
      side=2
      type=Wolf
      x,y=15,41
      id=Gnawbones_Alpha
      name="Gnawbones Alpha"
      [modifications]
        {TRAIT_RESILIENT}
        {TRAIT_STRONG}
        {PACK_LEADER 8 1}
      [/modifications]
      generate_name=no
      random_traits=no
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=2
      type=Wolf
      x,y=16,41
      id=Gnawbones_Beta
      name="Gnawbones Beta"
      [modifications]
        {TRAIT_RESILIENT}
        {TRAIT_STRONG}
        {PACK_LEADER 6 0}
      [/modifications]
      generate_name=no
      random_traits=no
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=2
      type=Wolf
      x,y=14,41
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=2
      type=Wolf Rider
      x,y=15,44
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [modify_side]
      side=2
      [ai]
        passive_leader=no	# Leader now not passive
        caution=0.4
        grouping=offensive
      [/ai]
      [ai]		# More aggressive at dusk/night/dawn
        time_of_day=dusk,midnight,dawn
        aggression=0.9
      [/ai]
      [ai]		# More cautious in daylight
        time_of_day=morning,midday,afternoon
        aggression=0.5
      [/ai]
      {GOLD 30 40 50}
    [/modify_side]
    [set_variable]
      name=ab_Gnawbones
      value=yes
    [/set_variable]
{PACK_ALERT_B}			# First time dialogue part two
  [/event]
#
  [event]			# Whiners (side 3)
    name=moveto
    [filter]
      side=1
      [filter_location]
        x,y=18,30
        radius=9
      [/filter_location]
    [/filter]
    {PACK_ALERT 3}
    [unit]
      side=3
      type=Wolf
      x,y=18,27
      id=Whiners_Alpha
      name="Whiners Alpha"
      [modifications]
        {TRAIT_RESILIENT}
        {TRAIT_STRONG}
        {PACK_LEADER 10 1}
      [/modifications]
      generate_name=no
      random_traits=no
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=3
      type=Wolf
      x,y=19,29
      id=Whiners_Beta
      name="Whiners Beta"
      [modifications]
        {TRAIT_STRONG}
        {TRAIT_RESILIENT}
        {PACK_LEADER 7 0}
      [/modifications]
      generate_name=no
      random_traits=no
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=3
      type=Wolf
      x,y=17,29
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=3
      type=Wolf
      x,y=17,28
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=3
      type=Wolf Rider
      x,y=16,29
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [modify_side]
      side=3
      [ai]
        passive_leader=no	# Leader now not passive
        caution=0.4
        grouping=offensive
      [/ai]
      [ai]		# More aggressive at dusk/night/dawn
        time_of_day=dusk,midnight,dawn
        aggression=0.9
      [/ai]
      [ai]		# More cautious in daylight
        time_of_day=morning,midday,afternoon
        aggression=0.6
      [/ai]
      {GOLD 50 65 80}
    [/modify_side]
    [set_variable]
      name=ab_Whiners
      value=yes
    [/set_variable]
{PACK_ALERT_B}			# First time dialogue part two
  [/event]
#
  [event]			# Muzzlegores (side 4)
    name=moveto
    [filter]
      side=1
      [filter_location]
        x,y=2,25
        radius=9
      [/filter_location]
    [/filter]
    {PACK_ALERT 4}
    [unit]
      side=4
      type=Great Wolf
      x,y=2,22
      id=Muzzlegores_Alpha
      name="Muzzlegores Alpha"
      [modifications]
        {TRAIT_RESILIENT}
        {TRAIT_STRONG}
        {PACK_LEADER 10 1}
      [/modifications]
      generate_name=no
      random_traits=no
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=4
      type=Great Wolf
      x,y=2,23
      id=Muzzlegores_Beta
      name="Muzzlegores Beta"
      [modifications]
        {TRAIT_STRONG}
        {TRAIT_RESILIENT}
        {PACK_LEADER 7 1}
      [/modifications]
      generate_name=no
      random_traits=no
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=4
      type=Great Wolf
      x,y=3,23
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=4
      type=Wolf
      x,y=4,23
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=4
      type=Goblin Knight
      x,y=4,24
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=4
      type=Wolf Rider
      x,y=4,25
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [modify_side]
      side=4
      [ai]
        passive_leader=no	# Leader now not passive
        caution=0.4
        grouping=offensive
      [/ai]
      [ai]		# More aggressive at dusk/night/dawn
        time_of_day=dusk,midnight,dawn
        aggression=0.9
      [/ai]
      [ai]		# More cautious in daylight
        time_of_day=morning,midday,afternoon
        aggression=0.65
      [/ai]
      {GOLD 100 120 140}
    [/modify_side]
    [set_variable]
      name=ab_Muzzlegores
      value=yes
    [/set_variable]
{PACK_ALERT_B}			# First time dialogue part two
  [/event]
#
  [event]			# Tanglers (side 5)
    name=moveto
    [filter]
      side=1
      [filter_location]
        x,y=26,22
        radius=9
      [/filter_location]
    [/filter]
    {PACK_ALERT 5}
    [unit]
      side=5
      type=Great Wolf
      x,y=24,20
      id=Tanglers_Alpha
      name="Tanglers Alpha"
      [modifications]
        {TRAIT_RESILIENT}
        {TRAIT_STRONG}
        {PACK_LEADER 11 1}
      [/modifications]
      generate_name=no
      random_traits=no
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=5
      type=Great Wolf
      x,y=25,21
      id=Tanglers_Beta
      name="Tanglers Beta"
      [modifications]
        {TRAIT_STRONG}
        {TRAIT_RESILIENT}
        {PACK_LEADER 6 1}
      [/modifications]
      generate_name=no
      random_traits=no
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=5
      type=Great Wolf
      x,y=24,21
      [modifications]
        {TRAIT_QUICK}
        {TRAIT_STRONG}
      [/modifications]
      generate_name=yes
      random_traits=no
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=5
      type=Wolf
      x,y=23,22
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=5
      type=Goblin Pillager
      x,y=24,23
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=5
      type=Wolf Rider
      x,y=25,24
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [modify_side]
      side=5
      [ai]
        passive_leader=no	# Leader now not passive
        caution=0.4
        grouping=offensive
      [/ai]
      [ai]		# More aggressive at dusk/night/dawn
        time_of_day=dusk,midnight,dawn
        aggression=0.9
      [/ai]
      [ai]		# More cautious in daylight
        time_of_day=morning,midday,afternoon
        aggression=0.7
      [/ai]
      {GOLD 110 130 150}
    [/modify_side]
    [set_variable]
      name=ab_Tanglers
      value=yes
    [/set_variable]
{PACK_ALERT_B}			# First time dialogue part two
  [/event]
#
  [event]			# Ripthroats (side 6)
    name=moveto
    [filter]
      side=1
      [filter_location]
        x,y=2,1
        radius=9
      [/filter_location]
    [/filter]
    {PACK_ALERT 6}
    [unit]
      side=6
      type=Direwolf
      x,y=2,3
      id=Ripthroats_Alpha
      name="Ripthroats Alpha"
      [modifications]
        {TRAIT_RESILIENT}
        {TRAIT_STRONG}
        {PACK_LEADER 12 2}
      [/modifications]
      generate_name=no
      random_traits=no
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=6
      type=Great Wolf
      x,y=1,4
      id=Ripthroats_Beta
      name="Ripthroats Beta"
      [modifications]
        {TRAIT_STRONG}
        {TRAIT_RESILIENT}
        {PACK_LEADER 9 1}
      [/modifications]
      generate_name=no
      random_traits=no
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=6
      type=Direwolf
      x,y=2,4
      [modifications]
        {TRAIT_QUICK}
      [/modifications]
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=6
      type=Great Wolf
      x,y=3,4
      [modifications]
        {TRAIT_QUICK}
      [/modifications]
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=6
      type=Wolf
      x,y=3,5
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=6
      type=Wolf
      x,y=3,3
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=6
      type=Direwolf Rider
      x,y=3,3
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=6
      type=Goblin Knight
      x,y=5,2
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=6
      type=Wolf Rider
      x,y=5,3
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=6
      type=Wolf Rider
      x,y=4,3
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [modify_side]
      side=6
      [ai]
        passive_leader=no	# Leader now not passive
        caution=0.4
        grouping=offensive
      [/ai]
      [ai]		# More aggressive at dusk/night/dawn
        time_of_day=dusk,midnight,dawn
        aggression=0.95
      [/ai]
      [ai]		# More cautious in daylight
        time_of_day=morning,midday,afternoon
        aggression=0.75
      [/ai]
      {GOLD 120 155 190}
    [/modify_side]
    [set_variable]
      name=ab_Ripthroats
      value=yes
    [/set_variable]
{PACK_ALERT_B}			# First time dialogue part two
  [/event]
#
  [event]			# Fellfangs (side 7)
    name=moveto
    [filter]
      side=1
      [filter_location]
        x,y=27,2
        radius=9
      [/filter_location]
    [/filter]
    {PACK_ALERT 7}
    [unit]
      side=7
      type=Direwolf
      x,y=24,1
      id=Fellfangs_Alpha
      name="Fellfangs Alpha"
      [modifications]
        {TRAIT_RESILIENT}
        {TRAIT_STRONG}
        {PACK_LEADER 15 2}
      [/modifications]
      generate_name=no
      random_traits=no
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=7
      type=Direwolf
      x,y=23,2
      id=Fellfangs_Beta
      name="Fellfangs Beta"
      [modifications]
        {TRAIT_STRONG}
        {TRAIT_RESILIENT}
        {PACK_LEADER 13 1}
      [/modifications]
      generate_name=no
      random_traits=no
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=7
      type=Direwolf
      x,y=25,2
      [modifications]
        {TRAIT_STRONG}
      [/modifications]
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=7
      type=Great Wolf
      x,y=24,2
      [modifications]
        {TRAIT_STRONG}
      [/modifications]
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=7
      type=Great Wolf
      x,y=23,3
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=7
      type=Wolf
      x,y=24,3
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=7
      type=Wolf
      x,y=25,3
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=7
      type=Direwolf Rider
      x,y=27,1
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=7
      type=Direwolf Rider
      x,y=25,4
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=7
      type=Goblin Knight
      x,y=26,4
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=7
      type=Goblin Pillager
      x,y=27,4
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [unit]
      side=7
      type=Wolf Rider
      x,y=28,4
      generate_name=yes
      random_traits=yes
      random_gender=yes
      animate=yes
      upkeep=free
    [/unit]
    [modify_side]
      side=7
      [ai]
        passive_leader=no	# Leader now not passive
        caution=0.4
        grouping=offensive
      [/ai]
      [ai]		# More aggressive at dusk/night/dawn
        time_of_day=dusk,midnight,dawn
        aggression=0.95
      [/ai]
      [ai]		# More cautious in daylight
        time_of_day=morning,midday,afternoon
        aggression=0.8
      [/ai]
      {GOLD 150 200 250}
    [/modify_side]
    [set_variable]
      name=ab_Fellfangs
      value=yes
    [/set_variable]
{PACK_ALERT_B}			# First time dialogue part two
  [/event]


#
# --- Eliminate wolf pack events (destroys keep) ---
  [event]
    name=moveto
    {DESTROY_KEEP 15 43 2 Gnawbones 1}
  [/event]
#
  [event]
    name=moveto
    {DESTROY_KEEP 18 30 3 Whiners 1}
  [/event]
#
  [event]
    name=moveto
    {DESTROY_KEEP 2 25 4 Muzzlegores 2}
  [/event]
#
  [event]
    name=moveto
    {DESTROY_KEEP 26 22 5 Tanglers 2}
  [/event]
#
  [event]
    name=moveto
    {DESTROY_KEEP 2 1 6 Ripthroats 2}
  [/event]
#
  [event]
    name=moveto
    {DESTROY_KEEP 27 2 7 Fellfangs 2}
  [/event]


#
# --- Keep respawn events
#
# First time dialogue
  [event]
    name=keep_respawn_first_time_dialogue
    [message]
      x,y=$keep_recapture_x, $keep_recapture_y
      message= _ "Hah!  Bosses dead!  Me boss now!"
    [/message]
  [/event]
#
# --- 20% chance of leader respawn if:
# - Alpha & beta wolves killed
# - Keep is unoccupied (by any unit)
# - Side has no units
# - Side has a keep
  [event]
    name=side 2 turn
    first_time_only=no
    {KEEP_RESPAWN 2 Gnawbones 15 43 (Wolf Rider) 17 20 23}
  [/event]
#
  [event]
    name=side 3 turn
    first_time_only=no
    {KEEP_RESPAWN 3 Whiners 18 30 (Wolf Rider) 25 30 35}
  [/event]
#
  [event]
    name=side 4 turn
    first_time_only=no
    {KEEP_RESPAWN 4 Muzzlegores 2 25 (Goblin Knight) 50 60 70}
  [/event]
#
  [event]
    name=side 5 turn
    first_time_only=no
    {KEEP_RESPAWN 5 Tanglers 26 22 (Goblin Pillager) 65 80 95}
  [/event]
#
  [event]
    name=side 6 turn
    first_time_only=no
    {KEEP_RESPAWN 6 Ripthroats 2 1 (Direwolf Rider) 130 170 210}
  [/event]
#
  [event]
    name=side 7 turn
    first_time_only=no
    {KEEP_RESPAWN 7 Fellfangs 27 2 (Direwolf Rider) 180 230 280}
  [/event]


# Amulet and Ring pickup and drop logic
{AEI_PICKDROP_AMULET}
{AEI_PICKDROP_RING}


# Tent villages destroyed if captured by goblin
  [event]
    name=capture
    first_time_only=no
    [filter]
      [not]
        side=1
      [/not]
      [filter_location]
        terrain="Gg^Vct"
      [/filter_location]
      race=goblin
    [/filter]
    [set_variable]
      name=tvx
      value=$x1
    [/set_variable]
    [set_variable]
      name=tvy
      value=$y1
    [/set_variable]
    [fire_event]		# First time dialogue part one
      name=tv_ftd1
    [/fire_event]
    [sound]
      name=torch.ogg
    [/sound]
    [delay]
      time=200
    [/delay]
    [sound]
      name=cave-in.ogg
    [/sound]
    [terrain]
      x,y=$x1,$y1
      terrain=Rb
    [/terrain]
    [redraw][/redraw]
    [fire_event]		# First time dialogue part two
      name=tv_ftd2
    [/fire_event]
    [clear_variable]
      name=tvx,tvy
    [/clear_variable]
  [/event]
#
  [event]
    name=tv_ftd1
    [message]
      x,y=$tvx,$tvy
      message = _ "Ugh, stinky.  What that smell?  Oh yes.  Soap."
    [/message]
  [/event]
#
  [event]
    name=tv_ftd2
    [message]
      x,y=$tvx,$tvy
      message = _ "Me do good!"
    [/message]
  [/event]


# Setup initial conditions
  [event]
    name=prestart
#
# --- Alpha and beta wolves created flags ---
# =no:    Not yet created
# =yes:   Created (may be dead)
#
    [set_variable]
      name=ab_Gnawbones
      value=no
    [/set_variable]
    [set_variable]
      name=ab_Whiners
      value=no
    [/set_variable]
    [set_variable]
      name=ab_Muzzlegores
      value=no
    [/set_variable]
    [set_variable]
      name=ab_Tanglers
      value=no
    [/set_variable]
    [set_variable]
      name=ab_Ripthroats
      value=no
    [/set_variable]
    [set_variable]
      name=ab_Fellfangs
      value=no
    [/set_variable]
    [set_variable]		# Elimination chance
      name=recruit_fail_wolf
      value=0
    [/set_variable]
#
# --- Villages ---
    [capture_village]		# Gnawbones (2)
      side=2
      x=17,22
      y=43,44
    [/capture_village]
    [capture_village]		# Whiners (3)
      side=3
      x=15,17,19
      y=32,33,31
    [/capture_village]
    [capture_village]		# Muzzlegores (3)
      side=4
      x= 1, 6, 7
      y=25,25,21
    [/capture_village]
    [capture_village]		# Tanglers (4)
      side=5
      x=22,23,25,28
      y=22,24,20,18
    [/capture_village]
    [capture_village]		# Ripthroats (5)
      side=6
      x=1,2,4,5,6
      y=1,6,2,6,1
    [/capture_village]
    [capture_village]		# Fellfangs (6)
      side=7
      x=17,19,24,25,27,27
      y= 1, 4, 6, 1, 3, 7
    [/capture_village]
    [recall]
      id=Dirk
      side=1
      x,y=4,41
    [/recall]
    [recall]
      id=Pierce
      side=1
      x,y=4,42
    [/recall]
    [capture_village]		# Player (3)
      side=1	
      terrain="Gg^Vct"
    [/capture_village]
    [set_variable]
      name=turns_total		# Current turns in scenario
      value={TURNS_START}
    [/set_variable]
  [/event]


# Start of game
  [event]
    name=start
    [objectives]
      [objective]
        description=_"Eliminate all the wolf packs"
        condition=win
      [/objective]
      [objective]
        {ALTERNATIVE_OBJECTIVE_CAPTION}
        description= _ "Retreat: move Flynn or Dirk to (1,44)"
        condition=win
        [show_if]
          [variable]
            name=recruit_fail_wolf
            greater_than=1
          [/variable]
        [/show_if]
      [/objective]
      [objective]
        description = _ "Death of Earl Flynn"
        condition=lose
      [/objective]
      [objective]
        description = _ "Death of Dirk"
        condition=lose
      [/objective]
      [objective]
        description= _ "Time runs out"
        condition=lose
        show_turn_counter=yes
      [/objective]
      {CARRYOVER 80}
      [note]
        description=_"<span foreground='#ffff00'>Despite time being short, eliminating a wolf pack usually persuades Flynn to fight on a bit longer.</span>"
        [show_if]
          [variable]		# Only display whilst no packs eliminated
            name=recruit_fail_wolf
            equals=0
          [/variable]
        [/show_if]
      [/note]
      [note]
        description=_"<span foreground='#00ff00'>Maximum turns reached.</span>"
        [show_if]
          [variable]
            name=turns_total
            equals={TURNS_MAX}
          [/variable]
        [/show_if]
      [/note]
    [/objectives]
  [/event]


#
# --- Victory Events ---

# Victory: retreat (enabled after an elimination)
  [event]
    name=moveto
    [filter_condition]
      [variable]
        name=recruit_fail_wolf
        greater_than=0
      [/variable]
    [/filter_condition]
    [filter]
      x,y=1,44
      id=Flynn, Dirk
    [/filter]
    [message]
      speaker=Flynn
      message= _ "Time presses.  Our allies await.  We must depart."
    [/message]
    [fire_event]
      name=23a2_victory
    [/fire_event]
  [/event]
#
# Victory
  [event]
    name=23a2_victory
    [clear_variable]
      name=ab_Gnawbones, ab_Whiners, ab_Muzzlegores, ab_Tanglers, ab_Ripthroats, ab_Fellfangs, turns_total
    [/clear_variable]
#ifdef __UNUSED__
    [store_gold]		# Flynn not in next scenario so save his gold and army
      side=1
      variable=Flynn_gold_save
    [/store_gold]
    [heal_unit]
      [filter]
        side=1
      [/filter]
      moves=full
      restore_attacks=yes
    [/heal_unit]
    [store_unit]
      variable=Flynn_army_save
      [filter]
        side=1
        [not]
          id=Flynn
        [/not]
        side=1
      [/filter]
      kill=yes
    [/store_unit]
#endif
    {AEI_PICKDROP_TEST_IF_UNAVAILABLE ring_02b}
    {AEI_PICKDROP_TEST_IF_UNAVAILABLE amulet_03}
    {ENDLEVEL 80}
  [/event]


#
# --- Die events ---

# Pack elimination messages
  [event]
    name=die
    first_time_only=no		# To allow for leader respawn
    [filter]			# Gnawbones
      side=2
    [/filter]
    [filter_condition]
      [have_unit]
        side=2
        count=0
      [/have_unit]
      [variable]
        name=ab_Gnawbones
        equals=yes
      [/variable]
    [/filter_condition]
    {DEFEATED_KEEP Gnawbones 15 43}
  [/event]
#
  [event]
    name=die
    first_time_only=no		# To allow for leader respawn
    [filter]			# Whiners
      side=3
    [/filter]
    [filter_condition]
      [have_unit]
        side=3
        count=0
      [/have_unit]
      [variable]
        name=ab_Whiners
        equals=yes
      [/variable]
    [/filter_condition]
    {DEFEATED_KEEP Whiners 18 30}
  [/event]
#
  [event]
    name=die
    first_time_only=no		# To allow for leader respawn
    [filter]			# Muzzlegores
      side=4
    [/filter]
    [filter_condition]
      [have_unit]
        side=4
        count=0
      [/have_unit]
      [variable]
        name=ab_Muzzlegores
        equals=yes
      [/variable]
    [/filter_condition]
    {DEFEATED_KEEP Muzzlegores 2 25}
  [/event]
#
  [event]
    name=die
    first_time_only=no		# To allow for leader respawn
    [filter]			# Tanglers
      side=5
    [/filter]
    [filter_condition]
      [have_unit]
        side=5
        count=0
      [/have_unit]
      [variable]
        name=ab_Tanglers
        equals=yes
      [/variable]
    [/filter_condition]
    {DEFEATED_KEEP Tanglers 26 22}
  [/event]
#
  [event]
    name=die
    first_time_only=no		# To allow for leader respawn
    [filter]			# Ripthroats
      side=6
    [/filter]
    [filter_condition]
      [have_unit]
        side=6
        count=0
      [/have_unit]
      [variable]
        name=ab_Ripthroats
        equals=yes
      [/variable]
    [/filter_condition]
    {DEFEATED_KEEP Ripthroats 2 1}
  [/event]
#
  [event]
    name=die
    first_time_only=no		# To allow for leader respawn
    [filter]			# Fellfangs
      side=7
    [/filter]
    [filter_condition]
      [have_unit]
        side=7
        count=0
      [/have_unit]
      [variable]
        name=ab_Fellfangs
        equals=yes
      [/variable]
    [/filter_condition]
    {DEFEATED_KEEP Fellfangs 27 2}
  [/event]


# Time runs out
{TIME_OVER}


  {AEI_DIRK_DEATH}
  {AEI_HERO_DEATHS}
  {AEI_PIERCE_DEATH}
  {AEI_ZIPP_DEATH}
  {AEI_SCAMPA_DEATHB}
[/scenario]

#undef TURNS_START
#undef TURNS_INCREASE
#undef TURNS_MAX

#undef GOBLIN_WEAKEST
#undef GOBLIN_ZERO
#undef GOBLIN_ALL

#undef WOLF_BASIC
#undef WOLF_KNIGHT
#undef WOLF_PILLAGER
#undef WOLF_NO_PILLAGER
#undef WOLF_ALL

#undef PACK_LEADER
#undef PACK_ALERT

#undef PLACE_FLAG
#undef REMOVE_FLAG

#undef DEFEATED_KEEP
#undef DESTROY_KEEP
#undef KEEP_RESPAWN
